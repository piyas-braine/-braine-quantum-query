"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[677],{2987(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>s,metadata:()=>i,toc:()=>u});const i=JSON.parse('{"id":"recipes","title":"Recipes","description":"Authentication Middleware","source":"@site/docs/recipes.md","sourceDirName":".","slug":"/recipes","permalink":"/-braine-quantum-query/recipes","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Migrating from RTK Query","permalink":"/-braine-quantum-query/migration"}}');var a=t(4848),r=t(8453);const s={},o="Recipes",c={},u=[{value:"Authentication Middleware",id:"authentication-middleware",level:2},{value:"Optimistic Updates",id:"optimistic-updates",level:2},{value:"Infinite Scroll UI",id:"infinite-scroll-ui",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"recipes",children:"Recipes"})}),"\n",(0,a.jsx)(n.h2,{id:"authentication-middleware",children:"Authentication Middleware"}),"\n",(0,a.jsx)(n.p,{children:"Inject auth tokens into every request using the Plugin System."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"import { queryCache } from '@braine/quantum-query';\n\nconst authPlugin = {\n    name: 'auth',\n    onFetchStart: (key) => {\n        console.log('Fetching', key);\n        // Note: Actual headers usually handled in your fetcher,\n        // but this is great for logging or analytics.\n    },\n    onFetchError: (key, error) => {\n        if (error.status === 401) {\n            logout();\n        }\n    }\n};\n\nqueryCache.use(authPlugin);\n"})}),"\n",(0,a.jsx)(n.h2,{id:"optimistic-updates",children:"Optimistic Updates"}),"\n",(0,a.jsx)(n.p,{children:"Update the UI immediately before the network request finishes."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const { refetch } = useQuery({ queryKey: ['todos'], ... });\n\nconst handleAddTodo = async (newTodo) => {\n    // 1. Snapshot previous state (optional) or just write\n    queryCache.set(['todos'], (old) => [...old, newTodo]);\n\n    // 2. Perform mutation\n    await api.post('/todos', newTodo);\n\n    // 3. Revalidate to ensure server consistency\n    queryCache.invalidate(['todos']);\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"infinite-scroll-ui",children:"Infinite Scroll UI"}),"\n",(0,a.jsx)(n.p,{children:'Simple implemention with a "Load More" button.'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-tsx",children:"function PostList() {\n    const { data, fetchNextPage, hasNextPage } = useInfiniteQuery({\n        queryKey: ['posts'],\n        queryFn: ({ pageParam }) => fetchPosts(pageParam),\n        getNextPageParam: (lastPage) => lastPage.nextCursor\n    });\n\n    if (!data) return <Skeleton />;\n\n    return (\n        <div>\n            {data.pages.map(page => (\n                page.items.map(post => <Post key={post.id} data={post} />)\n            ))}\n            <button \n                onClick={() => fetchNextPage()} \n                disabled={!hasNextPage}\n            >\n                {hasNextPage ? 'Load More' : 'No More Data'}\n            </button>\n        </div>\n    );\n}\n"})})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453(e,n,t){t.d(n,{R:()=>s,x:()=>o});var i=t(6540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);